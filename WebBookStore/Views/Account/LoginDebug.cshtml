<!DOCTYPE html>
<html>
<head>
    <title>Login Debug Test</title>
    <meta charset="utf-8" />
</head>
<body>
    <h1>Login Debug Test</h1>
    
    <h2>Test 1: Reset Password</h2>
    <button onclick="resetPassword()">Reset Password cho dungdeptrai@gmail.com</button>
    <div id="resetResult"></div>
    
    <h2>Test 2: Reset All Passwords</h2>
    <button onclick="resetAllPasswords()">Reset Táº¥t Cáº£ Passwords (123456)</button>
    <div id="resetAllResult"></div>
    
    <h2>Test 3: Test Hash</h2>
    <button onclick="testHash()">Test Hash cá»§a "123456"</button>
    <div id="testHashResult"></div>
    
    <h2>Test 4: Reset User Password</h2>
    <button onclick="resetUserPassword()">Reset Password cho dungdeptrai@gmail.com</button>
    <div id="resetUserResult"></div>
    
    <h2>Test 5: Find Correct Password</h2>
    <button onclick="findPassword()">TÃ¬m Password Ä‘Ãºng cho Hash</button>
    <div id="findPasswordResult"></div>
    
    <h2>Test 6: Test Multiple Passwords</h2>
    <button onclick="testMultiplePasswords()">Test Táº¥t Cáº£ Passwords</button>
    <div id="testMultipleResult"></div>
    
    <h2>Test 7: Direct Login Test</h2>
    <button onclick="directLoginTest()">Test Login Trá»±c Tiáº¿p</button>
    <div id="directLoginResult"></div>
    
    <h2>Test 8: Test Login</h2>
    <form id="testLoginForm">
        <div>
            <label>Email:</label>
            <input type="email" name="Email" value="dungdeptrai@gmail.com" required />
        </div>
        <div>
            <label>Password:</label>
            <input type="password" name="Password" value="123456" required />
        </div>
        <button type="submit">Test Login</button>
    </form>
    <div id="loginResult"></div>

    <script>
        function resetPassword() {
            fetch('/Account/ResetPassword?email=dungdeptrai@gmail.com&newPassword=123456')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('resetResult').innerHTML = 
                        '<div style="color: ' + (data.success ? 'green' : 'red') + '">' + data.message + '</div>';
                })
                .catch(error => {
                    document.getElementById('resetResult').innerHTML = 
                        '<div style="color: red">Error: ' + error.message + '</div>';
                });
        }

        function resetAllPasswords() {
            fetch('/Account/ResetAllPasswords')
                .then(response => response.json())
                .then(data => {
                    var resultHtml = '<div style="color: ' + (data.success ? 'green' : 'red') + '">' + data.message + '</div>';
                    if (data.users) {
                        resultHtml += '<div style="margin-top: 10px;"><strong>Users updated:</strong><ul>';
                        data.users.forEach(function(user) {
                            resultHtml += '<li>' + user.email + ' (' + user.fullName + ') - Password: 123456</li>';
                        });
                        resultHtml += '</ul></div>';
                    }
                    document.getElementById('resetAllResult').innerHTML = resultHtml;
                })
                .catch(error => {
                    document.getElementById('resetAllResult').innerHTML = 
                        '<div style="color: red">Error: ' + error.message + '</div>';
                });
        }

        function testHash() {
            fetch('/Account/TestHash?password=123456')
                .then(response => response.json())
                .then(data => {
                    var resultHtml = '<div style="color: ' + (data.success ? 'green' : 'red') + '">' + data.message + '</div>';
                    if (data.success) {
                        resultHtml += '<div style="margin-top: 10px;"><strong>Hash Details:</strong><br>';
                        resultHtml += 'Password: ' + data.password + '<br>';
                        resultHtml += 'Hash: ' + data.hash + '</div>';
                    }
                    document.getElementById('testHashResult').innerHTML = resultHtml;
                })
                .catch(error => {
                    document.getElementById('testHashResult').innerHTML = 
                        '<div style="color: red">Error: ' + error.message + '</div>';
                });
        }

        function resetUserPassword() {
            fetch('/Account/ResetUserPassword?email=dungdeptrai@gmail.com&newPassword=123456')
                .then(response => response.json())
                .then(data => {
                    var resultHtml = '<div style="color: ' + (data.success ? 'green' : 'red') + '">' + data.message + '</div>';
                    if (data.success) {
                        resultHtml += '<div style="margin-top: 10px;"><strong>Chi tiáº¿t:</strong><br>';
                        resultHtml += 'Email: ' + data.email + '<br>';
                        resultHtml += 'Username: ' + data.username + '<br>';
                        resultHtml += 'FullName: ' + data.fullName + '<br>';
                        resultHtml += 'Old Hash: ' + data.oldHash + '<br>';
                        resultHtml += 'New Hash: ' + data.newHash + '</div>';
                    }
                    document.getElementById('resetUserResult').innerHTML = resultHtml;
                })
                .catch(error => {
                    document.getElementById('resetUserResult').innerHTML = 
                        '<div style="color: red">Error: ' + error.message + '</div>';
                });
        }

        function findPassword() {
            fetch('/Account/FindPassword')
                .then(response => response.json())
                .then(data => {
                    var resultHtml = '<div style="color: ' + (data.success ? 'green' : 'red') + '">' + data.message + '</div>';
                    if (data.found) {
                        resultHtml += '<div style="margin-top: 10px; background: yellow; padding: 10px;"><strong>ðŸŽ‰ TÃŒM THáº¤Y PASSWORD:</strong><br>';
                        resultHtml += 'Password: <strong>' + data.password + '</strong><br>';
                        resultHtml += 'Hash: ' + data.hash + '</div>';
                    }
                    document.getElementById('findPasswordResult').innerHTML = resultHtml;
                })
                .catch(error => {
                    document.getElementById('findPasswordResult').innerHTML = 
                        '<div style="color: red">Error: ' + error.message + '</div>';
                });
        }

        function testMultiplePasswords() {
            fetch('/Account/TestMultiplePasswords')
                .then(response => response.json())
                .then(data => {
                    var resultHtml = '<div style="color: ' + (data.success ? 'green' : 'red') + '">' + data.message + '</div>';
                    if (data.results) {
                        resultHtml += '<div style="margin-top: 10px;"><strong>Káº¿t quáº£ test:</strong><br>';
                        data.results.forEach(function(result) {
                            var color = result.matches ? 'red' : 'black';
                            var style = result.matches ? 'background: yellow; font-weight: bold;' : '';
                            resultHtml += '<div style="color: ' + color + '; ' + style + '">';
                            resultHtml += 'Password: ' + result.password + ' â†’ Hash: ' + result.hash.substring(0, 20) + '... â†’ Khá»›p: ' + result.matches + '</div>';
                        });
                        resultHtml += '</div>';
                    }
                    document.getElementById('testMultipleResult').innerHTML = resultHtml;
                })
                .catch(error => {
                    document.getElementById('testMultipleResult').innerHTML = 
                        '<div style="color: red">Error: ' + error.message + '</div>';
                });
        }

        function directLoginTest() {
            fetch('/Account/DirectLoginTest?email=dungdeptrai@gmail.com&password=123456')
                .then(response => response.json())
                .then(data => {
                    var resultHtml = '<div style="color: ' + (data.success ? 'green' : 'red') + '">' + data.message + '</div>';
                    if (data.success && data.userFound) {
                        resultHtml += '<div style="margin-top: 10px;"><strong>Chi tiáº¿t:</strong><br>';
                        resultHtml += 'User: ' + data.user.username + ' (' + data.user.fullName + ')<br>';
                        resultHtml += 'Email: ' + data.user.email + '<br>';
                        resultHtml += 'Password Match: ' + data.passwordMatch + '<br>';
                        resultHtml += 'Input Hash: ' + data.inputPasswordHash + '<br>';
                        resultHtml += 'Database Hash: ' + data.user.databaseHash + '</div>';
                    }
                    document.getElementById('directLoginResult').innerHTML = resultHtml;
                })
                .catch(error => {
                    document.getElementById('directLoginResult').innerHTML = 
                        '<div style="color: red">Error: ' + error.message + '</div>';
                });
        }

        document.getElementById('testLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            var formData = new FormData(this);
            var params = new URLSearchParams();
            for (var pair of formData.entries()) {
                params.append(pair[0], pair[1]);
            }
            
            fetch('/Account/Login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: params
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loginResult').innerHTML = 
                    '<div style="color: ' + (data.ok ? 'green' : 'red') + '">' + 
                    (data.ok ? 'Login thÃ nh cÃ´ng!' : 'Login tháº¥t báº¡i: ' + (data.errors ? data.errors.join(', ') : 'Unknown error')) + 
                    '</div>';
            })
            .catch(error => {
                document.getElementById('loginResult').innerHTML = 
                    '<div style="color: red">Error: ' + error.message + '</div>';
            });
        });
    </script>
</body>
</html>
